<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1,user-scalable=no" name="viewport"/>
<title>LoopCake</title>
<link rel="stylesheet" href="style.css">

</head>
<body>

<!-- Splash Screen -->
<div id="splash" aria-hidden="true" role="presentation">
  <img src="logo.png" alt="LoopCake" />
</div>
<script>
  (function() {
    var s = document.getElementById('splash');
    setTimeout(function() {
      s.classList.add('splash-out');
      setTimeout(function() { s.style.display = 'none'; }, 650);
    }, 1800);
  })();
</script>

<!-- Seiten-Navigation -->
<nav class="page-nav" id="pageNav" aria-label="Seitennavigation">
  <button class="page-nav-btn active" id="navPlayer" aria-label="Player">
    <svg viewBox="0 0 16 16" fill="none" aria-hidden="true">
      <rect x="1"  y="5"  width="2" height="6"  rx="1" fill="currentColor"/>
      <rect x="5"  y="2"  width="2" height="12" rx="1" fill="currentColor"/>
      <rect x="9"  y="4"  width="2" height="8"  rx="1" fill="currentColor"/>
      <rect x="13" y="6"  width="2" height="4"  rx="1" fill="currentColor"/>
    </svg>
    Player
  </button>
  <button class="page-nav-btn" id="navEditor" aria-label="Editor">
    <svg viewBox="0 0 16 16" fill="none" aria-hidden="true">
      <rect x="2" y="3"  width="12" height="1.5" rx="0.75" fill="currentColor"/>
      <rect x="2" y="7"  width="9"  height="1.5" rx="0.75" fill="currentColor"/>
      <rect x="2" y="11" width="11" height="1.5" rx="0.75" fill="currentColor"/>
    </svg>
    Editor
  </button>
</nav>
<!-- Floating Media Controls -->
<div aria-label="Wiedergabesteuerung" class="media-fab">
<button aria-label="Abspielen" class="fab" id="floatPlay" title="Abspielen">
<svg aria-hidden="true" fill="none" viewbox="0 0 24 24">
<path d="M8 5v14l11-7z" fill="#90caf9"></path>
</svg>
</button>
<button aria-label="Stop" class="fab stop" id="floatStop" title="Stop">
<svg aria-hidden="true" fill="none" viewbox="0 0 24 24">
<rect fill="#fca5a5" height="12" rx="2" width="12" x="6" y="6"></rect>
</svg>
</button>
</div>
<div class="scene">
<div class="book" id="book">
<!-- Linke Seite (bestehende App) -->
<section class="page left">
<div class="title-wrap logo-wrap" style="display:flex;justify-content:center;align-items:center;margin-bottom:16px;"><img src="logo.png" alt="LoopCake" style="max-width:320px;width:100%;height:auto;display:block" /><button id="infoBadge" class="info-badge" aria-label="Info" title="Info"><svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="10" fill="#90caf9"></circle><rect x="11.1" y="10" width="1.8" height="6" rx="0.9" fill="#1e1e1e"></rect><circle cx="12" cy="7.5" r="1.1" fill="#1e1e1e"></circle></svg></button></div>
<div class="card stack"><!-- Row 1: Lade/ Speichere Projekt -->
<div class="grid-2">
<label class="btn primary" for="loadProjectFile">
<span class="icon">
<svg fill="none" viewbox="0 0 24 24"><path d="M12 3v12m0 0l-4-4m4 4l4-4M3 21h18" stroke="#90caf9" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"></path></svg>
</span>
          Lade Projekt
        </label>
<button class="btn" id="saveProject">
<span class="icon">
<svg fill="none" viewbox="0 0 24 24"><path d="M17 3H7a2 2 0 0 0-2 2v14l7-3 7 3V5a2 2 0 0 0-2-2z" stroke="#90caf9" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"></path></svg>
</span>
          Speichere Projekt
        </button>
<input accept="application/json,.json" class="file" id="loadProjectFile" type="file"/>
</div>
<!-- Row 2: Datei laden / Zurücksetzen -->
<div class="grid-2">
<label class="btn" for="file">
<span class="icon">
<svg fill="none" viewbox="0 0 24 24"><path d="M12 16V4m0 0l3 3m-3-3L9 7M4 20h16" stroke="#90caf9" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"></path></svg>
</span>
          Datei laden
        </label>
<button class="btn warn" id="clearBtn">
<span class="icon">
<svg fill="none" viewbox="0 0 24 24"><path d="M6 6l12 12M18 6L6 18" stroke="#fecaca" stroke-linecap="round" stroke-width="1.8"></path></svg>
</span>
          Zurücksetzen
        </button>
<input accept=".mp3,.wav,audio/*" class="file" id="file" type="file"/>
</div>
<div class="section-gap"></div>
<!-- Row 3: Dateiname / BPM -->
<div class="grid-2">
<div>
<div class="label">Dateiname</div>
<div class="filename-chip"><span class="dot"></span><span id="fileInfo">–</span></div>
</div>
<div>
<div class="label">Tempo (Original BPM)</div>
<input class="field mono" id="bpm" placeholder="" inputmode="decimal" type="text"/>
<button class="btn" id="tapBpm" style="margin-top:8px;width:100%;" title="Tippe im Takt">Tap BPM</button>
</div>
</div>
<!-- Waveform -->
<div class="section-gap"></div>
<!-- Trim Controls (neu) -->
<div class="grid-3" id="trimControls" style="margin-bottom:6px; display:flex; gap:6px; align-items:center; justify-content:flex-start;">
<button class="btn btn-sm" id="trimFront" title="Alles vor dem Cursor entfernen">Trim Front</button>
<button class="btn btn-sm" id="trimBack" title="Alles nach dem Cursor entfernen">Trim Back</button>
<button class="btn btn-sm" id="undoTrim" title="Letzten Schnitt rückgängig machen">Undo</button>
<button class="btn btn-sm toggle active" id="gridSnapBtn" title="Cursor am Raster einrasten">Grid Snap</button>
</div>
<canvas aria-label="Wellenform" height="240" id="wave"></canvas>
<!-- Marker setzen / entfernen -->
<div class="v-gap"></div>
<div id="markerControls">
<button class="btn btn-sm ok" id="addMarker" title="Marker am Cursor setzen">
<span class="icon">
<svg fill="none" viewbox="0 0 24 24">
<path d="M12 5v14M5 12h14" stroke="#86efac" stroke-linecap="round" stroke-width="1.8"></path>
</svg>
</span>
    Marker setzen
  </button>
<button class="btn btn-sm warn" id="deleteMarker" title="Marker am Cursor entfernen">
<span class="icon">
<svg fill="none" viewbox="0 0 24 24">
<path d="M6 6l12 12M18 6L6 18" stroke="#fecaca" stroke-linecap="round" stroke-width="1.8"></path>
</svg>
</span>
    Marker entfernen
  </button>
<button aria-label="Hilfe zu Markern &amp; Loop" class="help-badge" id="markerHelp" title="Hilfe">
<svg aria-hidden="true" fill="none" viewbox="0 0 24 24">
<circle cx="12" cy="12" fill="#90caf9" r="10"></circle>
<path d="M9.6 9.3a2.4 2.4 0 1 1 3.9 1.8c-.8.6-1.2 1-1.2 2" stroke="#1e1e1e" stroke-linecap="round" stroke-width="1.8"></path>
<circle cx="12" cy="16.6" fill="#1e1e1e" r="1.1"></circle>
</svg>
</button>
</div>
<div style="text-align:center">
<span class="under-time mono">Cursor: <span id="curLabel">0:00.000</span></span>
</div>
<div class="time-pitch-row" style="display:flex; flex-wrap:wrap; align-items:center; justify-content:center; gap:14px; margin-top:8px;">
<div class="taktart" style="display:flex; align-items:center; gap:6px;">
<label class="label" for="timeSig" style="margin-right:6px;">Taktart</label>
<select class="field" id="timeSig" style="display:inline-block; width:auto; padding:6px 10px;">
<option selected="" value="4">4/4</option>
<option value="3">3/4</option>
</select>
</div>
<div class="pitchCtrl" style="display:flex; align-items:center; gap:6px;">
<label class="label" title="Tonart ± 24 Halbtöne">Pitch</label>
<button class="btn" id="pitchMinus" style="padding:6px 10px;" title="Halbton runter">–</button>
<div class="mono" id="pitchVal" style="min-width:3em; text-align:center;">+0 st</div>
<button class="btn" id="pitchPlus" style="padding:6px 10px;" title="Halbton hoch">+</button>
</div>
<div class="tempoCtrl" style="display:flex; align-items:center; gap:6px;">
<label class="label" title="Wiedergabetempo – ändert nicht das Projekt-BPM oder das Raster">Playback Tempo</label>
<button class="btn" id="tempoMinus" style="padding:6px 10px;" title="Tempo −0,5 BPM">–</button>
<input class="field mono" id="tempoVal" inputmode="decimal" type="text" placeholder="—" style="width:5.5em; padding:6px 8px; text-align:center;" title="Tempo manuell eingeben, Enter zum Übernehmen"/>
<button class="btn" id="tempoPlus" style="padding:6px 10px;" title="Tempo +0,5 BPM">+</button>
<button class="btn" id="tempoReset" style="padding:6px 9px; opacity:.7;" title="Tempo zurücksetzen auf Projekt-BPM">×</button>
</div>
</div>
<div class="v-gap"></div>
<div class="card" id="markerSeqControls" style="cursor:pointer; display:flex; align-items:center; justify-content:space-between; gap:10px;"><div class="seq-left" style="display:flex; align-items:center; gap:10px; cursor:pointer;"><input id="playSeqToggle" style="width:18px;height:18px; accent-color:#5c9eff; cursor:pointer;" type="checkbox"/><span>Custom Arrangement</span></div><button aria-label="Hilfe zu Custom Arrangement" class="help-badge" id="seqHelp" title="Hilfe">
<svg aria-hidden="true" fill="none" viewbox="0 0 24 24">
<circle cx="12" cy="12" fill="#90caf9" r="10"></circle>
<path d="M9.6 9.3a2.4 2.4 0 1 1 3.9 1.8c-.8.6-1.2 1-1.2 2" stroke="#1e1e1e" stroke-linecap="round" stroke-width="1.8"></path>
<circle cx="12" cy="16.6" fill="#1e1e1e" r="1.1"></circle>
</svg>
</button></div>
<div class="v-gap"></div>
<div class="markerList" id="markerList"></div>
<!-- Großer Play / Stop -->
<div class="v-gap"></div>
<div class="grid-2">
<button class="btn big primary" id="playSel">
<span class="icon play"><svg fill="#90caf9" viewbox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg></span>
          Abspielen
        </button>
<button class="btn big" id="pauseBtn">
<span class="icon stop"><svg fill="#fca5a5" viewbox="0 0 24 24"><rect height="12" rx="2" width="12" x="6" y="6"></rect></svg></span>
          Stop
        </button>

<!-- Marker-Liste -->
<!-- NEU: Reihenfolge-Schalter --><input accept=".mp3,.wav,audio/*" class="file" id="loadAudioForProject" type="file"/>
</div>
<div class="v-gap"></div>
<div id="exportWrap" style="display:block;">
  <button class="btn big" id="exportWavBtn" style="display:block; width:100%;" title="Arrangement als WAV exportieren">Arrangement als WAV exportieren</button>
</div>
<div id="exportStatus" class="note-hint" style="display:none; text-align:center; margin-top:6px;">Export … 0%</div>
</section>
<!-- Rechte Seite: Texteditor gekoppelt an 2-Takt-Gruppen -->
<section class="page right">
<div class="title-wrap logo-wrap" style="display:flex;justify-content:center;align-items:center;margin-bottom:16px;"><img src="logo.png" alt="LoopCake" style="max-width:320px;width:100%;height:auto;display:block" /></div>
<div class="card note-wrap">
<div class="note-tools">
<button class="btn toggle" id="toggleAutoscroll" title="Automatisches Scrollen ein/aus">Autoscroll: An</button>
<button class="btn toggle" id="importMarkersBtn" title="Custom Arrangement in Editor übernehmen">Custom Arrangement übernehmen</button>
<div class="segment segment-reim-popups"><label class="label" style="margin-left:8px;">Reim-Popups</label>
<select class="field" id="rhymeMode" style="display:inline-block; width:auto; padding:8px 10px;">
<option selected="" value="off">Aus</option>
<option value="de">Deutsch</option>
<option value="en">Englisch</option>
</select><button aria-label="Hilfe zum Loopcake Editor" class="help-badge" id="editorHelp" title="Hilfe">
  <svg aria-hidden="true" fill="none" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="10" fill="#90caf9"></circle>
    <path d="M9.6 9.3a2.4 2.4 0 1 1 3.9 1.8c-.8.6-1.2 1-1.2 2" stroke="#1e1e1e" stroke-linecap="round" stroke-width="1.8"></path>
    <circle cx="12" cy="16.6" r="1.1" fill="#1e1e1e"></circle>
  </svg>
</button></div>
</div>
<div class="lyricsList" id="lyricsList"></div>
<div class="note-export">
<button class="btn" id="exportTxtBtn">Export</button>
</div>
</div>
</section>
</div>
</div> <!-- ---------- Bisheriges Skript + Flip-Logik ---------- -->

<!-- ===== Loop-Fix Patch (ensure loops work when Playlist aus) ===== -->
<!-- ===== Ende Loop-Fix Patch ===== -->
<!-- ===== Playlist-Dominanz & Jump-Guard Patch ===== -->
<!-- ===== Ende Playlist-Dominanz & Jump-Guard Patch ===== -->
<!-- === Rhyme popover for editor lines === -->
<div aria-live="polite" id="rhyme-popover" role="dialog" style="position: fixed; z-index: 99999; display:none; max-width: 360px; background: linear-gradient(160deg, rgba(255,255,255,0.03) 0%, transparent 100%), #15151c; border:1px solid rgba(255,255,255,0.08); border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,0.75), 0 1px 0 rgba(255,255,255,0.05) inset; font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; overflow:hidden; backdrop-filter:blur(8px);">
<div id="rhyme-popover-header" style="padding:11px 14px; font-weight:700; border-bottom:1px solid rgba(255,255,255,0.07); color:#eaeaf0; letter-spacing:0.2px;">Reime</div>
<div id="rhyme-popover-body" style="max-height: 280px; overflow:auto; background:rgba(0,0,0,0.2);"></div>
<div style="padding:8px 14px; border-top:1px solid rgba(255,255,255,0.06); font-size:11px; color:#606075;">
      Rhymes by <a href="https://rhymebrain.com" rel="noopener" target="_blank" style="color:#5b9fff;">RhymeBrain</a>
</div>
</div>
<!-- === Injection: Auto-disable "Custom Arrangement" when 2 markers are active === -->
<!-- === Export Popup (Modal) === -->
<div class="modal-backdrop" id="exportModal" style="display:none;">
<div class="modal-card">
<div class="modal-header">
<div class="modal-title">Exportierter Text</div>
<button class="btn btn-sm" id="closeExportModal" title="Schließen">Schließen</button>
</div>
<div class="modal-body">
<textarea class="field mono" id="exportTextArea" readonly="" rows="16"></textarea>
</div>
<div class="modal-footer">
  <button class="btn" id="copyExportText" title="In die Zwischenablage kopieren">Alles kopieren</button>
</div>

</div>
</div>
<!-- Info Modal -->
<div aria-labelledby="infoTitle" aria-modal="true" class="modal-backdrop info-modal" id="infoModal" role="dialog" style="display:none;">
<div class="modal-card">
<div class="modal-header">
<div class="modal-title" id="infoTitle"></div>
<button aria-label="Schließen" title="Schließen" class="btn btn-sm" id="infoClose">Schließen</button>
</div>
<div class="modal-body" style="display:block;">
<div>
<p><strong>LoopCake 1.0</strong></p><br/>
<p class="muted">© 2025 Tom Ottow. Alle Rechte vorbehalten.</p><br/>
<p>Diese App verarbeitet grundsätzlich alle Daten lokal auf Ihrem Gerät.</p>
<p>Bei Nutzung der Reimfunktion werden eingegebene Wörter an den externen Dienst
        <a href="https://rhymebrain.com" rel="noopener noreferrer" target="_blank">RhymeBrain</a>
        übermittelt, um passende Reimvorschläge zu erhalten.</p>
<p>Es werden keine weiteren personenbezogenen Daten übertragen.</p>
<br/>

    <p><strong>Keyboard Shortcuts:</strong></p>
    <ul>
        <li><strong>Space</strong> = Play/Stop</li>
        <li><strong>Backspace</strong> = Cursor zum Loopanfang / Custom Arrangement Beginn</li>
        <li><strong>T</strong> = Setze Marker</li>
        <li><strong>R</strong> = Entferne Marker</li>
        <li><strong>A</strong> = Marker aktiv/inaktiv</li>
        <li><strong>S</strong> = Snap Grid Ein/Aus</li>
        <li><strong>Pfeiltasten</strong> = Cursor auf der Waveform bewegen</li>
        <li><strong>Shift + Pfeiltasten</strong> = Zwischen Markern springen</li>
        <li><strong>CTRL + Z</strong> = Undo</li>
    </ul>
</div>
</div>
</div>
</div>
</div>
<!-- === Injected: Grid Help "?" + Popup (adjusted) === -->
<!-- === End Injected === -->
<!-- Marker Help Modal -->
<div aria-labelledby="markerHelpTitle" aria-modal="true" class="modal-backdrop info-modal" id="markerHelpModal" role="dialog" style="display:none;">
<div class="modal-card">
<div class="modal-header">
<div class="modal-title" id="markerHelpTitle">Marker &amp; Loops</div>
<button class="btn btn-sm" id="markerHelpClose" title="Schließen">Schließen</button>
</div>
<div class="modal-body">
<pre style="white-space: pre-wrap; font-family: inherit;">Du schreibst gerade deinen Song und willst nur diesen einen Abschnitt fertig kriegen, aber ständig musst du im Player wieder hin- und herspulen? Loope ihn doch einfach! 

Erstelle so viele Marker wie du willst und verschiebe sie per Drag &amp; Drop. 

Richte sie mit der Snap Grid Magnetfunktion aus, für absolut saubere Loops. 

Benenne die Marker frei, für einen perfekten Überblick im Arrangement. Tippe sie doppelt an, um sie umzubenennen.

Aktiviere und deaktiviere Marker mit Antippen. Zwei rote Marker ergeben einen Loop. 

Ein aktivierter Loop deaktiviert automatisch ein Custom Arrangement.

Doppeltes Tippen auf die Stop Taste lässt den Cursor zum Startmarker des Loops springen.</pre>
</div>
</div>
</div>
<div class="modal-backdrop help-modal" id="seqHelpModal"><div class="modal-card"><div class="modal-header"><div class="modal-title">Custom Arrangements</div><button aria-label="Schließen" title="Schließen" class="btn btn-sm btn-close" type="button">Schließen</button></div><div class="modal-body"><pre>Dein Instrumental hat nur einen Refrain am Ende, doch in deinem Kopf klingen zwei besser? Dafür magst du den Anfang der ersten Strophe nicht, die eine schöne Stelle in der zweiten Strophe könnte jedoch doppelt so lang sein? Und wenn doch nur dieser Zwischenteil vor dem Refrain und nicht danach kommen würde… Kein Problem! 

Aktiviere das Custom Arrangement und ordne die Abschnitte deiner Markerbereiche per Drag &amp; Drop neu an. 

Kopiere deine Abschnitte beliebig oft und puzzle dir deinen ultimativen Beat. 

Mute Bereiche, die dir nicht gefallen. Diese werden beim Abspielen komplett ausgelassen. 

Exportiere dein Custom Arrangement als WAV Audiodatei und nimm sie mit ins Studio. 

Ein aktiviertes Custom Arrangement deaktiviert Loops automatisch.

Doppeltes Tippen auf die Stop Taste lässt den Cursor zum Beginn des Arrangements springen.</pre></div></div></div>
<!-- Editor Help Modal -->
<div class="modal-backdrop help-modal" id="editorHelpModal" role="dialog" aria-modal="true" aria-labelledby="editorHelpTitle" style="display:none;">
  <div class="modal-card">
    <div class="modal-header">
      <div class="modal-title" id="editorHelpTitle">LoopCake Editor</div>
      <button class="btn btn-sm" id="editorHelpClose" title="Schließen">Schließen</button>
    </div>
    <div class="modal-body">
      <pre style="white-space: pre-wrap; font-family: inherit;">Mit dem LoopCake Editor hast du deine Lyrics voll im Griff - und vor allem im Blick!

Der Editor berechnet automatisch, wie viele Zeilen du schreiben musst und zeigt dir jederzeit, an welcher Stelle deines Songs du dich gerade befindest. 

Der Button “Marker übernehmen” richtet dein Textarrangement genau nach deinem Instrumental aus. 

Mit der Autoscroll-Funktion bleibst du auch bei laufendem Playback immer auf die passende Textzeile fokussiert. 

Du willst deinen gesamten Loop oder dein Custom Arrangement gerade nicht ändern, aber doch kurz einen anderen Abschnitt loopen? Halte die Zahl einer Textzeile gedrückt, zwei rote Zahlen ergeben einen Quick Loop. Halte erneut eine der beiden Zahlen gedrückt, um den Quick Loop zu beenden. 

Oder tippe einmal kurz auf die Zahl einer Zeile, um mit der Wiedergabe sofort an diesen Punkt zu springen. 

Es fehlt dir gerade noch der passende Reim für eine Zeile? Aktiviere die RhymeBrain Integration und tippe auf ein Wort deiner Lyrics, um Vorschläge zu erhalten! 

Deine fertigen Lyrics kannst du dir mit dem Export Button vollständig anzeigen und in die Zwischenablage kopieren lassen!</pre>
    </div>
    <div class="modal-footer">
      <button class="btn btn-sm btn-close" id="editorHelpClose2" title="Schließen" type="button">Schließen</button>
    </div>
  </div>
</div>

<script src="app.js" defer></script>
</body>
</html>